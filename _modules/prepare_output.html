

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>prepare_output &mdash; GEddySoft 4.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=3304f9e4"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GEddySoft
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/running_example.html">Running on Example Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../version.html">Version History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Implementation Details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory/software_architecture.html">Software Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GEddySoft</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">prepare_output</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for prepare_output</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>


<div class="viewcode-block" id="prepare_output">
<a class="viewcode-back" href="../api/_autosummary/prepare_output.prepare_output.html#prepare_output.prepare_output">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prepare_output</span><span class="p">(</span><span class="n">ini</span><span class="p">,</span> <span class="n">out_len</span><span class="p">,</span> <span class="n">hdf5_nb_tracers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hdf5_mz_tracer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preparation of the results dict.</span>
<span class="sd">    If the positional args are not provided, it will create the sonic/IRGA part of the results dict.</span>
<span class="sd">    If the positional args are provided, it will create the TRACER part of the results dict.</span>

<span class="sd">    parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ini: dict, initialisation information</span>
<span class="sd">    out_len: int, number of sonic files to be processed</span>
<span class="sd">    hdf5_nb_tracers:</span>
<span class="sd">    hdf5_mz_tracer:</span>
<span class="sd">    results: dictionnary that will be filled with all info to be outputed in the hdf5 files</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    results: dictionnary that will be filled with all info to be outputed in the hdf5 files</span>

<span class="sd">    comments</span>
<span class="sd">    --------</span>
<span class="sd">    Written by B. Heinesch, 2 January, 2023.</span>
<span class="sd">    University of Liege, Gembloux Agro-Bio Tech.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">hdf5_nb_tracers</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;procedure_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">][</span><span class="s1">&#39;procedure_version&#39;</span><span class="p">]</span>             <span class="c1"># semantic versioning</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;procedure_version_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">][</span><span class="s1">&#39;procedure_version_date&#39;</span><span class="p">]</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;file_creation_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># store parameters</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;SONIC_ORIENTATION&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SONIC_ORIENTATION&#39;</span><span class="p">],</span>                   <span class="c1"># degree</span>
            <span class="s1">&#39;SENSOR_HEIGHT&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SENSOR_HEIGHT&#39;</span><span class="p">],</span>                           <span class="c1"># meters above roughness height</span>
            <span class="s1">&#39;WINDOW_LENGTH&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;WINDOW_LENGTH&#39;</span><span class="p">],</span>                           <span class="c1"># samples</span>
            <span class="s1">&#39;SAMPLING_RATE_SONIC&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SAMPLING_RATE_SONIC&#39;</span><span class="p">],</span>               <span class="c1"># per second sonic anemometer sampling rate</span>
            <span class="s1">&#39;SAMPLING_RATE_TRACER&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SAMPLING_RATE_TRACER&#39;</span><span class="p">],</span>             <span class="c1"># per second gas analyzer sampling rate</span>
            <span class="s1">&#39;DETREND_TEMPERATURE_SIGNAL&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;DETREND_TEMPERATURE_SIGNAL&#39;</span><span class="p">],</span> <span class="c1"># if 1, linear detrending is applied to temperature signal</span>
            <span class="s1">&#39;DETREND_TRACER_SIGNAL&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;DETREND_TRACER_SIGNAL&#39;</span><span class="p">],</span>           <span class="c1"># if 1, linear detrending is applied to tracer signal</span>
            <span class="s1">&#39;LAG_DETECT_METHOD&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_DETECT_METHOD&#39;</span><span class="p">],</span>                   <span class="c1"># time-lag detection method to be applied; choose between: &#39;CONST&#39;, &#39;MAX&#39;, &#39;MAX_WITH_DEFAULT&#39;. </span>
                                                                                           <span class="c1"># If CONST, then the center of the [LAG_SEARCH_MIN,LAG_SEARCH_MAX] will be used</span>
            <span class="s1">&#39;LAG_PRESCRIBED&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">][</span><span class="s1">&#39;lag_prescribed_filepath&#39;</span><span class="p">],</span>                <span class="c1"># If a mz proposed, only the lag on this (closest) mz will be estimated, and used for all mz. </span>
                                                                                           <span class="c1"># Insert 0 if this option should not be used</span>
            <span class="s1">&#39;LAG_WINDOW_CENTER&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_WINDOW_CENTER&#39;</span><span class="p">],</span>                   <span class="c1"># expected physical lag (not including possible clock drift)</span>
            <span class="s1">&#39;LAG_OUTER_WINDOW_SIZE&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_OUTER_WINDOW_SIZE&#39;</span><span class="p">],</span>           <span class="c1"># time lag plotting window around the expected lag (in samples)</span>
            <span class="s1">&#39;LAG_INNER_WINDOW_SIZE&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_INNER_WINDOW_SIZE&#39;</span><span class="p">],</span>           <span class="c1"># time lag search window around the expected lag (in samples)</span>
            <span class="s1">&#39;LAG_COVPEAK_FILTER_LENGTH&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_COVPEAK_FILTER_LENGTH&#39;</span><span class="p">],</span>   <span class="c1"># samples length of filter applied to covariance peak prior to lag-time determination</span>
            <span class="s1">&#39;LAG_RH_DEPENDENCY&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LAG_RH_DEPENDENCY&#39;</span><span class="p">],</span>                   <span class="c1"># imposed time-lag, overruling, for provided mz, the MAX/MAX_WITH_DEFAULT window center</span>
                                                                                      <span class="c1"># or the PRESCRIBED lag (0 if applied, 1 if not)</span>

            <span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">],</span>                           <span class="c1"># number of logarithmically spaced frequency bins for (co)spectra</span>
            <span class="s1">&#39;TILT_CORRECTION_MODE&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;TILT_CORRECTION_MODE&#39;</span><span class="p">],</span>             <span class="c1"># 0: no tilt correction, 1: double rotation, 2: angle-dependent planar fit</span>
            <span class="s1">&#39;APPLY_WPL_CORRECTION&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;APPLY_WPL_CORRECTION&#39;</span><span class="p">],</span>             <span class="c1"># low-pass filtering correction on fluxes (0 = no correction, 1 = cut-off frequency + Massman as reference co-spectra, 2 = wind-speed dependent correction factor)</span>
            <span class="s1">&#39;COMPLETENESS_THRESHOLD&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;COMPLETENESS_THRESHOLD&#39;</span><span class="p">],</span>         <span class="c1"># threshold value for completeness of input data (0.0 - 1.0)</span>
            <span class="s1">&#39;DEFAULT_PRESSURE&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;DEFAULT_PRESSURE&#39;</span><span class="p">],</span>                     <span class="c1"># hPa / mbar fixed pressure used if no pressure is given in the input files</span>
            <span class="s1">&#39;SPIKE_MODE&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SPIKE_MODE&#39;</span><span class="p">],</span>                                 <span class="c1"># 0 = no spikes handling, 1 = spike detection, 2 = spikes detection and replacement</span>
            <span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_W&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_W&#39;</span><span class="p">],</span>             <span class="c1"># standard deviations threshold for detecting w spikes in the input data</span>
            <span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_T&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_T&#39;</span><span class="p">],</span>             <span class="c1"># standard deviations threshold for detecting T spikes in the input data</span>
            <span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_IRGA&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_IRGA&#39;</span><span class="p">],</span>       <span class="c1"># standard deviations threshold for detecting IRGA spikes in the input data</span>
            <span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_TRACER&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;SPIKE_DETECTION_THRESHOLD_TRACER&#39;</span><span class="p">],</span>   <span class="c1"># standard deviations threshold for detecting TRACER spikes in the input data</span>
            <span class="s1">&#39;MAX_CONSEC_SPIKES&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;MAX_CONSEC_SPIKES&#39;</span><span class="p">],</span>                   <span class="c1"># maximum number of consecutive outliers that can be considered as spikes</span>
            <span class="s1">&#39;MEAS_ID&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;MEAS_ID&#39;</span><span class="p">],</span>                                       <span class="c1"># measurement ID</span>

            <span class="s1">&#39;LPFC&#39;</span><span class="p">:</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;LPFC&#39;</span><span class="p">]</span>                                              <span class="c1"># low-pass filtering correction on fluxes (0 = no correction, 1 = cut-off frequency + Massman as reference co-spectra, 2 = wind-speed dependent correction factor)</span>

            <span class="p">}</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>                        <span class="c1"># frequency axis of (co)spectra [1/s]</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;MET&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># &#39;uvw&#39;: [[np.NaN]*3]*out_len,        # mean wind speed vector (u, v, w), with u component pointing into direction of mean wind [m/s]</span>
                <span class="s1">&#39;u_unrot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># unrotated mean u wind speed component [m/s]</span>
                <span class="s1">&#39;v_unrot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># unrotated mean v wind speed component [m/s]</span>
                <span class="s1">&#39;w_unrot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># unrotated mean w wind speed component [m/s]</span>
                <span class="s1">&#39;u_rot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># rotated mean u wind speed component [m/s]</span>
                <span class="s1">&#39;v_rot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># rotated mean v wind speed component [m/s]</span>
                <span class="s1">&#39;w_rot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># rotated mean w wind speed component [m/s]</span>
                <span class="s1">&#39;std_u&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># standard deviation of rotated u wind speed component [m/s]</span>
                <span class="s1">&#39;std_v&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># standard deviation of rotated v wind speed component [m/s]</span>
                <span class="s1">&#39;std_w&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># standard deviation of rotated w wind speed component [m/s]</span>
                <span class="s1">&#39;wsh&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># horizontal wind speed [m/s]</span>
                <span class="s1">&#39;std_wsh&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># horizontal wind speed standard deviation [m/s]</span>
                <span class="s1">&#39;wdir&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>         <span class="c1"># horizontal wind direction [deg]</span>
                <span class="s1">&#39;std_wdir&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># horizontal wind direction standard deviation[deg]</span>
                <span class="s1">&#39;phi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># second rotation angle [deg]</span>
                <span class="s1">&#39;tilt&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">out_len</span><span class="p">))),</span>
                                 <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_len</span><span class="p">)])),</span>
                <span class="s1">&#39;uw&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># covariance of along-wind and vertical wind component, &lt;u&#39;w&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;vw&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># covariance of cross-wind and vertical wind component, &lt;v&#39;w&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;uv&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># covariance of along-wind and cross-wind component, &lt;u&#39;v&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;uu&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># auto-covariance of along-wind component, &lt;u&#39;u&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;vv&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># auto-covariance of cross-wind component, &lt;v&#39;v&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;ww&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># auto-covariance of vertical wind component, &lt;w&#39;w&#39;&gt; [m^2/s^2]</span>
                <span class="s1">&#39;ust&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># friction velocity, u* [m/s]</span>
                <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># sonic temperature [K]</span>
                <span class="s1">&#39;std_T&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># standard deviation of temperature [K]</span>
                <span class="s1">&#39;wT&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># temperature flux, &lt;w&#39;T&#39;&gt; [K*m/s]</span>
                <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># Obukhov out_length [m]</span>
                <span class="s1">&#39;zoL&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># stability parameter, z/L, dimensionless</span>
                <span class="s1">&#39;spec_T&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span> <span class="c1"># spectrum for T, Sp(T&#39;,f)</span>
                <span class="s1">&#39;spec_T_scaled&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span> <span class="c1"># scaled spectrum for T, f*Sp(T&#39;,f)/TT</span>
                <span class="s1">&#39;cospec_wT&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span> <span class="c1"># cospectrum for wT, Co(w&#39;,c&#39;,f)</span>
                <span class="s1">&#39;cospec_wT_scaled&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span> <span class="c1"># scaled cospectrum for wT, f*Co(w&#39;,T&#39;,f)/wT</span>
                <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># pressure [hPa]</span>
                <span class="s1">&#39;rho_air_molar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span> <span class="c1"># dry molar air density [mol m-3]</span>
                <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># potential temperature [K]</span>
                <span class="s1">&#39;theta_v&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># virtual potential temperature [K]</span>
                <span class="s1">&#39;wtheta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>       <span class="c1"># potential temperature (heat) flux, &lt;w&#39;theta&#39;&gt; [K*m/s]</span>
                <span class="s1">&#39;wtheta_v&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># vitual potential temperature (buoyancy) flux, &lt;w&#39;theta_v&#39;&gt; [K*m/s]</span>
                <span class="s1">&#39;P_air&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># air pressure [mbar]</span>
                <span class="s1">&#39;T_air&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># air temperature [mbar]</span>
                <span class="s1">&#39;RH_air&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>       <span class="c1"># air relative humidity [%]</span>
                <span class="s1">&#39;qaqc&#39;</span><span class="p">:</span>    <span class="p">{</span>
                    <span class="s1">&#39;completeness_sonic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>         <span class="c1"># fraction of sonic data used in this interval</span>
                    <span class="s1">&#39;num_spikes_w&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>         <span class="c1"># number of w spikes detected in this interval</span>
                    <span class="s1">&#39;num_spikes_T&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>         <span class="c1"># number of T spikes detected in this interval</span>
                    <span class="s1">&#39;SST_wT_FW96&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># steady state test for wT after Foken &amp; Wichura 1996</span>
                    <span class="s1">&#39;SST_wT_M98&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># steady state test for wT after Mahrt 1998</span>
                    <span class="s1">&#39;SST_wT_D99&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>           <span class="c1"># steady state test for wT after Dutaur 1999</span>
                    <span class="s1">&#39;ITC_w&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>                <span class="c1"># relative model deviation of integral turbulence characteristics test for w</span>
                    <span class="s1">&#39;ITC_u&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>                <span class="c1"># relative model deviation of integral turbulence characteristics test for u</span>
                    <span class="s1">&#39;ITC_T&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>                <span class="c1"># relative model deviation of integral turbulence characteristics test for T</span>
                    <span class="s1">&#39;IPT_w&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">out_len</span><span class="p">,</span>             <span class="c1"># instrumental malfunctions tests for w, from Vitale 2020</span>
                    <span class="s1">&#39;IPT_T&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">out_len</span><span class="p">,</span>             <span class="c1"># instrumental malfunctions tests for T, from Vitale 2020</span>
                            <span class="p">}</span>
                          <span class="p">}</span>

        <span class="k">if</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;run_param&#39;</span><span class="p">][</span><span class="s1">&#39;CONCENTRATION_TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">IRGA</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;compound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>                               <span class="c1"># tracer name</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;conc_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>          <span class="c1"># mean concentration [ppbv, if IRGA concentration provided in ppbv]</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;conc_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>           <span class="c1"># standard deviation of concentration</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;lagtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>            <span class="c1"># lag time determined from individual averaging interval [s]</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;lagtime_clock_drift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># clock drift lag time provided as input [s]</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>               <span class="c1"># flux from individual lagtime [umol/m^2/s, if IRGA concentration provided in ppbv]</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># spectrum for c</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;spec_scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># scaled spectrum for c</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;cospec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># cospectrum for wc</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;cospec_scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># scaled cospectrum for wc</span>
            <span class="n">IRGA</span><span class="p">[</span><span class="s1">&#39;qaqc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;completeness_IRGA&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>   <span class="c1"># fraction of IRGA data used in this interval</span>
                <span class="s1">&#39;num_spikes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># number of spikes detected in this interval</span>
                <span class="s1">&#39;SST_FW96&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># steady state test for tracer after Foken &amp; Wichura 1996</span>
                <span class="s1">&#39;SST_M98&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>             <span class="c1"># steady state test for tracer after Mahrt 1998</span>
                <span class="s1">&#39;SST_D99&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>             <span class="c1"># steady state test for tracer after Dutaur 1999</span>
                <span class="s1">&#39;IPT&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">out_len</span><span class="p">,</span>              <span class="c1"># instrumental malfunctions tests for irga, from Vitale 2020</span>
                <span class="s1">&#39;flux_SNR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># flux signal to noise ratio</span>
                <span class="s1">&#39;flux_noise_std&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># standard deviation of flux noise far off integral time scale</span>
                <span class="s1">&#39;flux_noise_mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># mean flux noise far off integral time scale</span>
                <span class="s1">&#39;flux_noise_rmse&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># RMSE of flux noise far off integral time scale</span>
                <span class="s1">&#39;random_error_FS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># random error as described by Finkelstein and Sims 2001</span>
                <span class="s1">&#39;random_error_noise&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>  <span class="c1"># random error noise estimated according to Mauder 2013</span>
                <span class="s1">&#39;random_flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>         <span class="c1"># random flux level estimated by random shuffle criterium by Billesbach 2011</span>
                          <span class="p">}</span>

            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;IRGA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ini</span><span class="p">[</span><span class="s1">&#39;irga&#39;</span><span class="p">][</span><span class="s1">&#39;irga_columns&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))),</span>
                                       <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">IRGA</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ini</span><span class="p">[</span><span class="s1">&#39;irga&#39;</span><span class="p">][</span><span class="s1">&#39;irga_columns&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)]))</span>  <span class="c1"># struct containing results for each tracer</span>

            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;IRGA&#39;</span><span class="p">][</span><span class="s1">&#39;cf_lpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>

            <span class="k">del</span> <span class="n">IRGA</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ini</span><span class="p">[</span><span class="s1">&#39;irga&#39;</span><span class="p">][</span><span class="s1">&#39;irga_columns&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;IRGA&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;irga&#39;</span><span class="p">][</span><span class="s1">&#39;irga_names&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">TRACER</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;mz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>                               <span class="c1"># protonated mass to charge ratio</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>        <span class="c1"># mean tracer concentration [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_acc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>         <span class="c1"># accuracy of the tracer concentration [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_prec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>        <span class="c1"># precision of the tracer concentration [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_LOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>         <span class="c1"># limit of detection of tracer concentration [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>         <span class="c1"># standard deviation of the tracer concentration distribution [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_Q5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>          <span class="c1"># quartile 5 of the tracer concentration distribution [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;conc_Q95&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>         <span class="c1"># quartile 95 of the tracer concentration distribution [ppb]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;lagtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>          <span class="c1"># lag time (lag time (physical + clock_drift)) determined from individual averaging interval [s]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;lagtime_clock_drift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>    <span class="c1"># clock_drift lag time provided as input [s]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>             <span class="c1"># flux from individual lagtime [ug/m^2/s]</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>           <span class="c1"># spectrum for c</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;spec_scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>    <span class="c1"># scaled spectrum for c</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;cospec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>         <span class="c1"># cospectrum for wc</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;cospec_scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">ini</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;NUM_FREQ_BINS&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_len</span>  <span class="c1"># scaled cospectrum for wc</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;qaqc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;completeness_TRACER&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>        <span class="c1"># fraction of TRACER data used in this interval</span>
            <span class="s1">&#39;num_spikes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>          <span class="c1"># number of spikes detected in this interval</span>
            <span class="s1">&#39;SST_FW96&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># steady state test for tracer after Foken &amp; Wichura 1996</span>
            <span class="s1">&#39;SST_M98&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>             <span class="c1"># steady state test for tracer after Mahrt 1998</span>
            <span class="s1">&#39;SST_D99&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>             <span class="c1"># steady state test for tracer after Dutaur 1999</span>
            <span class="s1">&#39;IPT&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="n">out_len</span><span class="p">,</span>              <span class="c1"># instrumental malfunctions tests for tracer, from Vitale 2020</span>
            <span class="s1">&#39;flux_SNR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>            <span class="c1"># flux signal to noise ratio</span>
            <span class="s1">&#39;flux_noise_std&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>      <span class="c1"># standard deviation of flux noise far off integral time scale</span>
            <span class="s1">&#39;flux_noise_mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># mean flux noise far off integral time scale</span>
            <span class="s1">&#39;flux_noise_rmse&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># RMSE of flux noise far off integral time scale</span>
            <span class="s1">&#39;random_error_FS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>     <span class="c1"># random error as described by Finkelstein and Sims 2001</span>
            <span class="s1">&#39;random_error_noise&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span><span class="p">,</span>  <span class="c1"># random error noise estimated according to Mauder 2013</span>
            <span class="s1">&#39;random_flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>          <span class="c1"># random flux level estimated by random shuffle criterium (Billesbach 2011)</span>
                      <span class="p">}</span>

        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;calibration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>     <span class="c1"># transmission-corrected calibration coefficient</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;transmission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>    <span class="c1"># transmission</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;Xr0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>             <span class="c1"># Xr0</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;cluster_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>     <span class="c1"># cluster_min</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;cluster_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>     <span class="c1"># cluster max</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;k_reac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>          <span class="c1"># Ion/Molecule reaction rate constant</span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;FY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>              <span class="c1"># Fragmentation yield to correct signal due to fragmentation in the drift tube </span>
        <span class="n">TRACER</span><span class="p">[</span><span class="s1">&#39;IF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>              <span class="c1"># Isotopic factor to correct isotopic ratio</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;TRACER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hdf5_nb_tracers</span><span class="p">))),</span>
                                    <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">TRACER</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdf5_nb_tracers</span><span class="p">)]))</span>  <span class="c1"># struct containing results for each tracer</span>

        <span class="k">del</span> <span class="n">TRACER</span>

        <span class="c1"># fill mz values</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdf5_nb_tracers</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;TRACER&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;mz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hdf5_mz_tracer</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;TRACER&#39;</span><span class="p">][</span><span class="s1">&#39;cf_lpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>               <span class="c1"># correction factor for low-pass filtering</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;TRACER&#39;</span><span class="p">][</span><span class="s1">&#39;default_CC_kinetic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span> <span class="o">*</span> <span class="n">out_len</span>   <span class="c1"># default_CC_kinetic</span>

    <span class="k">return</span> <span class="n">results</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Bernard Heinesch.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>